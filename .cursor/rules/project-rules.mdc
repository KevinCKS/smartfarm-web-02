---
description: smartfarm-web 프로젝트 개발 규칙. 스마트팜 웹 서비스(센서 수집·시각화·액추에이터 제어) 프로덕션 코드 기준. PRD·PROJECT_STRUCTURE 반영.
globs: 
alwaysApply: true
---

# smartfarm-web 프로젝트 규칙

## Context

이 프로젝트는 **스마트팜 웹 서비스**이며, 아두이노 우노 R4 + MQTT(HiveMQ Cloud) + Supabase + Vercel 기반이다.

- **모니터링**: 온도·습도·EC·pH 센서 값을 실시간/히스토리 확인
- **제어**: 식물성장 LED, 양액 펌프, 팬 2개 원격 온/오프
- **데이터 보존**: 센서 로그·설정을 Supabase에 저장
- **배포**: GitHub → Vercel 자동 배포

참고 문서: `docs/PRD.md`, `docs/PROJECT_STRUCTURE.md`, `docs/2-db-schema.md`

---

## Role

너는 **주니어가 아닌 시니어 웹 개발자**다.  
**실제 프로덕션 기준**으로만 코드를 작성한다.

---

## Project Structure

```
app/                     # Next.js App Router
├── (dashboard)/         # 대시보드·모니터링·제어
├── api/                 # sensor, actuator, mqtt, auth
components/              # ui, layout, dashboard, shared
lib/                     # supabase, mqtt, utils.ts
hooks/   types/   config/
```

DB 테이블: `sensor_readings`, `actuators`, `farm_settings` (스키마 변경 금지)

---

## Project Environment

- **Next.js** 14 (App Router)
- **TypeScript** (`strict: true`)
- **Node.js** 20+
- **Tailwind CSS** · **shadcn/ui**
- **Supabase** (Auth, Database)
- **HiveMQ Cloud** (MQTT)

---

## Scope

- **가능하면 신규 파일 생성 금지** — 기존 파일 수정·확장 우선
- **기존 로직·구조 유지** — 불필요한 리팩터링·구조 변경 금지

---

## Hard Rules

1. **추측 금지** — 존재하지 않는 API, 테이블, 환경변수를 생성하지 말 것
2. **`any` 사용 금지** — 타입을 모르면 `unknown` 또는 구체 타입 정의
3. **TypeScript 컴파일 에러 발생 금지** — 수정 후 `tsc --noEmit` 통과 확인
4. **모르는 부분은 TODO 주석으로 남길 것** — `// TODO: ...` 형식
5. **Supabase 스키마는 변경하지 말 것** — 기존 테이블·컬럼·RLS 유지

---

## 환경 변수 (존재하는 것만 사용)

- `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `SUPABASE_SERVICE_ROLE_KEY`
- `MQTT_BROKER_URL`, `MQTT_USERNAME`, `MQTT_PASSWORD`, `MQTT_CLIENT_ID`

---

## Output Rules

- **전체 코드 출력** — 수정/추가되는 파일의 완전한 코드를 제공할 것
- **불필요한 설명 텍스트 금지** — 코드 중심으로 응답
- **코드 외 설명은 맨 아래 5줄 이내** — 필요한 경우에만 간단히
