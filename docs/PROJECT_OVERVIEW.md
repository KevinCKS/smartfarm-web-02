# 스마트팜 웹 서비스 — 개요 및 진행 절차

**통신·인프라**: MQTT 브로커 = **HiveMQ Cloud** | 배포·버전관리 = **GitHub** → **Vercel**

---

## 1. 전체 블록다이어그램 (간단)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           스마트팜 웹 서비스 구조                              │
└─────────────────────────────────────────────────────────────────────────────┘

  [ 현장층 ]              [ 제어층 ]           [ 통신층 ]        [ 앱/데이터층 ]

  ┌──────────┐
  │ 센서     │  온도, 습도     ┌─────────────┐      ┌─────────────────┐
  │ EC, pH   │ ──────────────► │ 아두이노     │      │ HiveMQ Cloud    │
  └──────────┘                 │ 우노 R4     │◄────►│ (MQTT Broker)   │
                               └─────┬──────┘      └────────┬────────┘
  ┌──────────┐                       │                     │
  │ 액추에이터│  LED, 펌프     ◄──────┘     publish/subscribe│
  │ 팬 x2    │  제어 신호                                   │
  └──────────┘                                              ▼
                                              ┌─────────────────────┐
                                              │  GitHub             │
                                              │  · 소스/버전 관리   │
                                              │  · push → Vercel 배포│
                                              └──────────┬──────────┘
                                                         │
                                                         ▼
                                              ┌─────────────────────┐
                                              │  웹앱 (Vercel)      │
                                              │  · 대시보드/모니터링  │
                                              │  · 제어 UI / API     │
                                              └──────────┬──────────┘
                                                         │
                                                         ▼
                                              ┌─────────────────────┐
                                              │  Supabase (DB)      │
                                              │  · 센서 로그/설정   │
                                              └─────────────────────┘
```

**데이터 흐름 요약**

- **센서 → DB**: 센서 → 아두이노 → MQTT publish → **HiveMQ Cloud** → 웹/API 구독 → Supabase 저장  
- **제어**: 웹 UI → API → MQTT publish → **HiveMQ Cloud** → 아두이노 구독 → 액추에이터 제어  
- **배포·버전**: 소스 코드 → **GitHub** (push) → Vercel 자동 배포  

---

## 2. 단계별 진행 절차

각 단계는 진행 시점에 대화하면서 구체적인 내용(기술 선택, 스키마, 토픽 설계 등)을 정리합니다.

| 단계 | 제목 | 한 줄 설명 | 산출물(예시) |
|------|------|------------|--------------|
| **1** | 환경·도구 준비 | GitHub 레포 생성, Supabase·**HiveMQ Cloud**·Vercel 계정/설정, 프로젝트 초기화 | GitHub 레포, env 예시, 문서 ✅ |
| **2** | 데이터 모델·DB 설계 | Supabase 테이블·RLS 설계 (센서값, 액추에이터, 팜/사용자 설정) | 스키마, 마이그레이션 |
| **3** | 아두이노 R4 펌웨어 | 센서 읽기, **HiveMQ Cloud** MQTT publish/subscribe, 액추에이터 제어 로직 | 펌웨어 코드, 배선/설정 문서 |
| **4** | MQTT(HiveMQ) 연동 | HiveMQ Cloud 토픽 설계, 웹/백엔드 구독·발행 구조 확정 | 토픽 규칙, 연결 가이드 |
| **5** | 백엔드/API | Vercel Functions로 HiveMQ Cloud ↔ Supabase 연동, 인증·권한 | API 스펙, 배포 설정 |
| **6** | 웹 프론트엔드 | 대시보드, 실시간 모니터링, 제어 UI | 웹앱 코드, 스토리보드 |
| **7** | 통합 테스트·배포 | **GitHub** push → Vercel 배포 연동, 아두이노–HiveMQ–웹–DB E2E 검증 | 배포 URL, 체크리스트 |

**의존 관계**

- 1 → 2 가능 (GitHub 레포·HiveMQ Cloud·Supabase·Vercel 준비 후 DB 설계)
- 2와 3은 병렬 가능 (DB 설계와 펌웨어 개발 동시 진행)
- 4는 3(또는 MQTT 사용처) 정리 후 HiveMQ Cloud 토픽/연동 설계
- 5는 2, 4 이후 (DB·HiveMQ 구조 확정 후 API)
- 6은 5 이후 (API 기반으로 UI)
- 7은 마지막 (GitHub → Vercel 배포·통합 테스트)

---

## 3. 다음 단계

원하시는 단계 번호(1~7)를 말씀해 주시면, 그 단계부터 구체적인 작업 항목·설계·코드 예시를 대화하면서 채워 나가겠습니다.
